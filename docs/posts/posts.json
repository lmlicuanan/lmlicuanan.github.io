[
  {
    "path": "posts/2022-02-03-demystifying-openstreetmap-data/",
    "title": "Demystifying OpenStreetMap Data",
    "description": "Suprisingly easy to grab rich information from one of the largest repositories of (free) geospatial data.",
    "author": [
      {
        "name": "Lino Licuanan",
        "url": {}
      }
    ],
    "date": "2022-02-03",
    "categories": [
      "data-science",
      "geospatial"
    ],
    "contents": "\n\nContents\nIntroduction\n\nIntroduction\n\n\nsuppressPackageStartupMessages({\n  library(osmdata)\n  library(tidyverse)\n  library(sf)\n})\n\n\n\n\n\nhttr::set_config(httr::config(ssl_verifypeer = FALSE))\n\nstudy_region.bb <- getbb(\"Makati\", format_out = \"polygon\") %>% head(1)\n\nbuilding.ql <- \n  study_region.bb %>% opq() %>% \n  add_osm_feature(key = \"building\")\n\nroad.ql <- \n  study_region.bb %>% opq() %>% \n  add_osm_feature(key = \"highway\")\n\ncity.ql <- \n  study_region.bb %>% opq() %>% \n  add_osm_feature(key = \"admin_level\", value = \"6\")\n\nboundary.ql <- \n  study_region.bb %>% opq() %>% \n  add_osm_feature(key = \"admin_level\", value = \"10\")\n\namenity.ql <- \n  study_region.bb %>% opq() %>% \n  add_osm_feature(key = \"amenity\")\n\nbuilding.sf     <- building.ql %>% osmdata_sf() %>% trim_osmdata(study_region.bb)\nroad.sf         <- road.ql %>% osmdata_sf() %>% trim_osmdata(study_region.bb)\nboundary.sf     <- boundary.ql %>% osmdata_sf() %>% trim_osmdata(study_region.bb)\ncity.sf         <- city.ql %>% osmdata_sf() %>% trim_osmdata(study_region.bb)\n# left untrimmed to factor in edge correction\namenity.sf      <- amenity.ql %>% osmdata_sf()\n# only randomly sample in areas where there is a known building\nset.seed(2022)\nmc_point.sf     <- st_as_sf(st_sample(city.sf$osm_multipolygons, 22 * 16))\n\nhttr::set_config(httr::config(ssl_verifypeer = TRUE))\n\namenity_point.sf <- amenity.sf$osm_points %>% \n  transmute(\n    amenity = case_when(\n      amenity == \"bank\" ~ \"bank\",\n      amenity %in% c(\"restaurant\", \"fast_food\") ~ \"restaurant\",\n      amenity %in% c(\"bar\", \"pub\", \"gambling\", \"nightclub\", \"casino\") ~ \"bar\",\n      amenity %in% c(\"bus_station\", \"taxi\", \"ferry_terminal\") ~ \"terminal\",\n      amenity %in% c(\"clinic\", \"hospital\", \"doctors\", \"dentist\") ~ \"hc_facility\",\n      amenity == \"pharmacy\" ~ \"pharmacy\",\n      amenity %in% c(\"school\", \"college\") ~ \"school\",\n      amenity == \"place_of_worship\" ~ \"place_of_worship\",\n      TRUE ~ NA_character_\n    ), value = TRUE\n  ) %>% mutate(amenity_key = amenity) %>% \n  filter(!is.na(amenity)) %>% spread(key = amenity_key, value = value, fill = FALSE)\n\nmc_point_params.sf <- aggregate(\n  amenity_point.sf,\n  mc_point.sf,\n  FUN = function(x) sum(as.logical(x), na.rm = TRUE),\n  join = function(x, y) st_is_within_distance(x, y, dist = 250)\n) %>% filter(!is.na(amenity))\n\n\n\n\n\nggplot() +\n  geom_sf(data = building.sf$osm_polygons) +\n  geom_sf(data = road.sf$osm_lines) +\n  geom_sf(data = amenity_point.sf %>% filter(!bank), \n          aes(group = amenity, colour = amenity),\n          alpha = 0.8) +\n  geom_sf(data = mc_point_params.sf, aes(alpha = bank, size = bank), col = \"red\") +\n  scale_colour_viridis_d() + \n  labs(\n    title = \"Points of Interest and Bank Density in the City of Makati, Philippines\", \n    caption = \"Bank density measured by counting bank branches within 250-m radius.\"\n  )\n\n\n\n\n\n\n\n",
    "preview": "posts/2022-02-03-demystifying-openstreetmap-data/makati.png",
    "last_modified": "2022-02-04T01:55:57+08:00",
    "input_file": {}
  }
]
